<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Treaty â€” Production Merge (Branding + v1 Logic)</title>

  <!-- PWA basics -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#A7E0DC" />

  <style>
    :root{
      --bg:#FAFAF5;--panel:#FFFFFF;--ink:#2E2E2E;--muted:#838383;--line:#EAEAEA;
      --teal:#A7E0DC;--mint:#CDECC7;--amber:#FFE3A1;--coral:#FFB3AB;--gray:#D8D8D8;--chip:#F3F3F3;
      --meter-a:#CDECC7;--meter-b:#BEE58C;--target:#FFD8C2;
      --r-lg:16px;--shadow:0 10px 30px rgba(0,0,0,.08);
      --fab-h:96px;
    }
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      color:var(--ink);
      display:flex;justify-content:center;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap{width:100%;max-width:480px;padding:14px 14px calc(var(--fab-h,96px) + 24px);align-items:center;gap:12px;margin-bottom:16px}

    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{margin:0;font-size:1.6rem;font-weight:900;letter-spacing:.2px}
    .cat{width:56px;height:56px;border-radius:14px;overflow:hidden;box-shadow:var(--shadow);border:1px solid #E9DED3}
    .cat img{width:100%;height:100%;object-fit:cover}

    /* Core hero card: meter left, info right */
    .meter-card{background:var(--panel);border-radius:var(--r-lg);box-shadow:var(--shadow);padding:16px;display:flex;gap:16px;align-items:flex-start}
    .meter{position:relative;width:56px;height:clamp(260px,52vh,360px);border-radius:999px;background:#F2F2F2;overflow:hidden}
    .meter .fill{position:absolute;bottom:0;left:0;right:0;height:50%;background:linear-gradient(180deg,var(--meter-b),var(--meter-a));transition:height .25s ease}
    .meter .marker{position:absolute;left:-6px;right:-6px;height:0;border-top:2px dashed var(--target)}

    .side{flex:1;display:flex;flex-direction:column;gap:10px}
    .pct{font-size:2.4rem;font-weight:900;align-self:flex-start;margin-top:0}

    .kv{display:flex;gap:8px;flex-wrap:wrap}
    .pill{background:#F7FBFA;border:1px solid #E7F1F0;border-radius:999px;padding:6px 10px;font-weight:800;font-size:.9rem}

    .segment{display:inline-flex;border:1px solid var(--gray);border-radius:999px;padding:4px;gap:4px}
    .seg{border:1px solid transparent;border-radius:999px;padding:8px 12px;font-weight:800;cursor:pointer;background:transparent}
    .seg.active{background:var(--teal)}
    .helper{font-size:.86rem;color:var(--muted)}

    .legend-list{display:flex;flex-direction:column;gap:6px;margin-top:6px}
    .legend-item{display:flex;justify-content:space-between;gap:12px;font-size:.92rem}
    .legend-item .label{color:var(--muted)}
    .legend-item .value{font-weight:800;color:var(--ink);opacity:.85}

    .spark{width:100%;height:46px}

    /* Collapsible Challenge */
    .challenge{margin-top:10px;border-top:1px dashed #eee;padding-top:10px}
    .bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:6px 0}
    select{appearance:none;border:1px solid var(--gray);border-radius:999px;padding:8px 10px;background:#fff;color:var(--ink)}
    .btn{appearance:none;border:1px solid transparent;border-radius:999px;padding:10px 14px;font-weight:700;cursor:pointer;font-size:.95rem}
    .btn.ok{background:#CDECC7}
    .btn.ghost{background:transparent;border-color:var(--gray);color:var(--ink)}
    .small{font-size:.85rem}
    .muted{color:var(--muted)}

    /* Footer + sticky actions */
    .footer{margin-top:14px;display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:.9rem}
    .link{text-decoration:underline;cursor:pointer}
    .fab{position:fixed;left:0;right:0;bottom:0;padding:10px 14px calc(10px + env(safe-area-inset-bottom));background:rgba(250,250,245,.9);backdrop-filter:blur(8px);border-top:1px solid #ececec;z-index:100}
    .fab .row{display:flex;gap:8px}
    .btn.mint{background:var(--mint)}.btn.amber{background:var(--amber)}.btn.coral{background:var(--coral)}

    /* History */
    .screen{display:none}.screen.active{display:block}
    .toolbar{display:flex;align-items:center;gap:10px;margin-bottom:10px}
    .back{width:36px;height:36px;border-radius:999px;background:var(--teal);color:#fff;display:grid;place-items:center;border:0;cursor:pointer}
    .table{background:var(--panel);border-radius:var(--r-lg);box-shadow:var(--shadow);overflow:hidden}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 12px;bor
